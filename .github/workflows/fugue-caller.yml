name: fugue-caller

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]
  workflow_dispatch:
    inputs:
      issue_number:
        description: "Issue number to process"
        required: true
        type: string

permissions:
  issues: write
  contents: read

concurrency:
  group: fugue-task-${{ github.repository }}-${{ github.event.issue.number || github.event.inputs.issue_number || github.run_id }}
  cancel-in-progress: false

jobs:
  route:
    uses: cursorvers/fugue-orchestrator/.github/workflows/fugue-task-router.yml@v1
    with:
      issue_number: ${{ github.event.issue.number || github.event.inputs.issue_number }}
    secrets:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      ZAI_API_KEY: ${{ secrets.ZAI_API_KEY }}
